<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      body { font-family: sans-serif; padding: 15px; background: #f8f9fa; }
      .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); max-width: 500px; margin: auto; }
      h3 { color: #333; text-align: center; }
      .field { margin-bottom: 25px; }
      label { display: block; font-weight: bold; margin-bottom: 5px; }
      .desc { font-size: 0.85em; color: #666; margin-bottom: 8px; }
      input[type="range"] { width: 100%; cursor: pointer; }
      .val-display { text-align: center; font-size: 1.1em; font-weight: bold; color: #4CAF50; margin-top: 5px; }
      .comment { text-align: center; font-size: 0.9em; color: #888; min-height: 1.2em; }
      button { width: 100%; padding: 15px; background: #4CAF50; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; }
    </style>
  </head>
  <body>
    <div class="card">
      <h3>Manus 感情 × エネルギー</h3>
      
      <div class="field">
        <label>感情 (x軸: -100 〜 100)</label>
        <div class="desc">左：しんどい / 右：うれしい</div>
        <input type="range" id="emotion" min="-100" max="100" value="0" oninput="updateLabels()">
        <div id="em-val" class="val-display">0</div>
        <div id="em-comment" class="comment">ふつう</div>
      </div>

      <div class="field">
        <label>身体エネルギー (y軸: -100 〜 100)</label>
        <div class="desc">下：ぐったり / 上：みなぎる</div>
        <input type="range" id="energy" min="-100" max="100" value="0" oninput="updateLabels()">
        <div id="en-val" class="val-display">0</div>
        <div id="en-comment" class="comment">ふつう</div>
      </div>

      <button onclick="submitData()">今の状態を記録</button>

      <div style="margin-top: 30px;">
        <canvas id="emotionChart"></canvas>
      </div>
    </div>

    <script>
      let chart;

      // ラベルとコメントを更新する関数
      function updateLabels() {
        const em = document.getElementById('emotion').value;
        const en = document.getElementById('energy').value;
        
        document.getElementById('em-val').innerText = em;
        document.getElementById('en-val').innerText = en;

        // 感情のコメント
        let emText = "ふつう";
        if (em <= -70) emText = "かなり しんどい";
        else if (em < -20) emText = "ちょっと しんどい";
        else if (em > 70) emText = "最高に うれしい";
        else if (em > 20) emText = "うれしい";
        document.getElementById('em-comment').innerText = emText;

        // エネルギーのコメント
        let enText = "ふつう";
        if (en <= -70) enText = "動けない・ぐったり";
        else if (en < -20) enText = "少し疲れ気味";
        else if (en > 70) enText = "パワー全開！";
        else if (en > 20) enText = "元気がある";
        document.getElementById('en-comment').innerText = enText;
      }

      window.onload = () => { 
        updateLabels();
        google.script.run.withSuccessHandler(drawChart).getLogs(); 
      };

      function drawChart(logs) {
        const ctx = document.getElementById('emotionChart').getContext('2d');
        if (chart) chart.destroy();
        chart = new Chart(ctx, {
          type: 'scatter',
          data: {
            datasets: [{
              label: '心のマップ',
              data: logs.map(row => ({ x: row.emotion, y: row.energy })),
              backgroundColor: '#4CAF50',
              pointRadius: 6
            }]
          },
          options: {
            scales: {
              x: { title: { display: true, text: '感情 (←しんどい / うれしい→)' }, min: -100, max: 100 },
              y: { title: { display: true, text: 'エネルギー (←疲れ / 元気→)' }, min: -100, max: 100 }
            }
          }
        });
      }

      function submitData() {
        const data = {
          emotion: document.getElementById('emotion').value,
          energy: document.getElementById('energy').value
        };
        google.script.run.withSuccessHandler(() => {
          alert('記録しました！');
          google.script.run.withSuccessHandler(drawChart).getLogs();
        }).recordToSheet(data);
      }
    </script>
  </body>
</html>
